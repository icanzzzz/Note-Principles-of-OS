---
title: 死锁
---



# 概述

## Remind

- > 各进程相互等待对方手里的资源，导致各进程都阻塞，无法向前推进（两个或多个进程无期限阻塞、相互等待）的==状态==

- 死锁、饥饿、死循环的区别

  - 死锁：至少是两个进程一起死锁，死锁进程处于阻塞态
  - 饥饿：可以只有一个进程饥饿，饥饿进程可能阻塞也可能就绪
  - 死循环：可能只有一个进程发生死循环，死循环的进程可上处理机
  - 死锁和饥饿是操作系统要解决的问题，死循环是应用程序员要解决的

## 产生的必要条件

### ==互斥条件==

- > 对必须互斥使用的资源的争抢才会导致死锁

### ==不剥夺条件==

- > 进程保持的资源只能主动释放，不可强行剥夺（与保持不同，不剥夺强调于==资源只能由进程自己释放==，对应客体动作，即==不会被客体抢走资源==）

### ==请求和保持条件==

- > 保持着某些资源不放的同时，请求别的资源（与不剥夺不同，==保持==强调==拿不到资源也不释放==已有资源，对应主体动作，即==自己不去释放资源==）

### ==循环等待条件==

- 存在一种进程资源的循环等待链
- 循环等待未必死锁，死锁一定有循环等待
  - 导致死锁的循环等待（死锁避免就是应对这种情况）
  - 不会导致死锁的循环等待（也就是循环外的程序，有资源会释放）

## 处理策略
### 不允许死锁发生

#### 静态策略

- > 预防死锁（==从根本逻辑上破坏死锁产生的可能，保证如何运行都不会死锁==）

#### 动态策略

- > 避免死锁（==运行时避免进入不安全状态，从而防止从不安全状态走向导致死锁的循环等待==）

### 允许死锁发生

#### 死锁的检测和解除

# 预防死锁

## 原理

- > 破坏死锁产生的必要条件，从源头破坏死锁的出现。保证无论怎么运行都不会有死锁和走向死锁的方向

## 破坏互斥条件

## 破坏不剥夺条件
### 放弃自身资源

- > 进程 Pi 申请 Rj 类资源时，检查 Rj 中有无可用资源：有则分配给 Pi ；==否则将 Pi 占有的资源全部释放而进入等待状态==

### 抢占其他的资源

- > 当进程 Pi 申请 Rj 类型的资源时检查 Rj 中有无可用资源：有则分配给 Pi ；==否则检查已获得 Rj 类资源的进程 Pk ，若 Pk 处于等待资源状态，则抢占 Pk 的 Rj 类资源并分配给 Pi，若 Pk 不处于等待资源状态，则置 Pi 于等待资源状态==（此时Pi原已占有的资源可能被抢占）

## 破幻请求和保持条件
### 破坏请求条件

- ==静态分配方法：每个进程执行之前，必须一次性地申请其在整个运行期间所需的全部资源==，全部申请到了才能运行。这样它在整个运行过程中便不会再提出资源请求，从而破坏了“请求”条件。

### 破坏保持条件

- > ==每个进程提出申请资源前必须释放已占有的一切资源==

## 破坏循环等待条件

### ==有序资源利用法==

- > 给系统中的所有资源类型进行排序==编号==

- 每个进程==只能按递增顺序申请资源==，即进程申请了序号为 8 的资源后，下次只能申请序号为 9 或以上资源

- 如果进程需要同一资源类型的多个实例（也就是序号相同的资源），则必须对它们==一起进行申请==

- 如果进程后面又想申请序号低的资源（比如5），那就必须把现在拥有的序号为5及其以上的资源全部释放

### 核心

- 每个进程只能按递增顺序申请资源，因此每个时刻总有一个进程占据了较高序号的资源，那么它后面继续申请的资源一定是空闲的，这就保证了进程是可以一直向前推进的

# 避免死锁

## 原理

- > 运行过程中对走向死锁的方向剪枝

## ==安全序列==

- 如果系统按照这种序列分配资源，则==每个进程==都能==顺利完成==。安全序列可能有多个

## ==安全状态==

- > 至少有一个安全序列

## 银行家算法

## Tip

- 死锁避免并不限制用户申请资源的顺序，而是==限制分配资源的顺序==

# 检测和解除

## 检测

### 数据机构

#### ==资源分配图==

#### 两种节点

##### 进程节点

##### 资源节点

#### 两种边

##### 进程节点---\>资源节点（请求边）

##### 资源节点---\>进程节点（分配边）

### 死锁检测算法

#### 原理

- 依次消除与不阻塞进程相连的边，直到无边可消

#### 死锁定理

- > 若资源分配图不可完全简化，说明发生了死锁

#### Tip

- 所谓不阻塞进程是指其申请的资源数还足够的进程

## 解除
### 资源剥夺法

### 撤销进程法（终止进程法）

### 进程回退法