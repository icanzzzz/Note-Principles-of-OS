---
title: 磁盘
---



# 概述

## 基本概念

- 磁盘：由表面涂有磁性物质的圆形盘片组成
- 磁道：每个盘片被划分为一个个磁道
- 扇区：每个磁道又划分为一个个扇区
- 盘面：磁盘有多个盘片摞起来，每个盘片有两个盘面
- 柱面：所有盘面中相对位置相同的磁道组成柱面

## 工作原理

- 磁头移动到目标位置，盘片旋转，对应扇区划过磁道才能完成读/写

## 磁盘的物理地址

- 【柱面号，盘面号，扇区号】

## 磁盘的分类

### 根据磁头是否可移动

#### 固定头磁盘

- 每个磁道只有一个磁头

#### 移动头磁盘

- 每个盘面只有一个磁头

### 根据盘片是否可更换

#### 固定盘磁盘

#### 可换盘磁盘

# 磁盘调度

## 一次磁盘读/写操作时间

### 寻找时间（寻道时间）

- > 在读/写数据前，将磁头移动到制定磁道所花的时间

- ==启动磁头臂==时间，假设耗时s。
  ==移动磁头==时间。假设磁头匀速运动，每跨越一个磁道耗时为m，总共需要跨越n条磁道。
  寻道时间T~S~ = s + m × n

### 延迟时间

- > 通过旋转磁盘，使磁头定位到目标扇区所需要的时间

- 假设磁盘转速为r（单位：转/秒，或转/分）。

- $$
  平均所需的延迟时间T_R = \frac{1}{2} \times \frac{1}{r} = \frac{1}{2r}
  $$

### 传输时间

- > 从磁盘读出或向磁盘写入数据所经历的时间

- 假设磁盘转速为r，此次读/写的字节数为b，每个磁道上的字节数为N。

- $$
  传输时间T_t = \frac{1}{r} \times \frac{b}{N} = \frac{b}{r \times N}
  $$

### Tip

- $$
  总的平均存取时间T_a = T_S + \frac{1}{2r} + \frac{b}{r \times N}
  $$

- 

## 磁盘调度算法

### 先来先服务（FCFS）

- ==根据进程请求访问磁盘的先后顺序进行调度==
- 优点：公平
- 缺点：大量进程竞争使用磁盘，且访问的磁道很分散，性能就会很差，寻道时间长

### 最短寻找时间优先（SSTF）

- ==优先处理与当前磁头最近的磁道==
- 可保证每次的寻道时间最短，但不能保证总的寻道时间最短
- 优点：性能较好，平均寻道时间短
- 缺点：可能产生饥饿

### 扫描算法（SCAN）

- 只有==磁头移动到最外侧的时候才能向内移动、移动到最内侧时才能向外移动==
- 优点：性能较好，平均寻道时间短，不会产生饥饿现象
- 缺点：只有到达最边上的磁道时才能改变磁头方向，各磁道的响应频率不平缓

### LOOK算法

- 基于SCAN，当==磁头移动方向上已经没有请求，就可以立即改变磁头移动方向==
- 优点：比起SCAN，不需要每次移动到最外侧或最内侧才能改变磁头方向，进一步缩短寻道时间

### 循环扫描算法（C-SCAN）

- 只有磁头朝某特定方向移动时才处理磁道访问请求，而==返回时直接快速移动至起始端而不处理任何请求==
- 优点：比起SCAN，对于各个位置磁道的响应频率很平缓
- 缺点：只有到达最边上的磁道时才能改变磁头移动方向，且比起SCAN平均寻道时间更长

### C-LOOK算法

- 基于C-SCAN的LOOK算法

## 减少磁盘延迟时间的方法

### 概述

- 磁头读入一个扇区数据后需要一小段时间处理，如果逻辑上相邻的扇区在物理上也相邻，则读取完扇区后不能立即读取下一扇区，处理完后需要等待扇区再次划过磁头才能继续读取。所以可能需要很长的延迟时间

### 交替编号

- 使逻辑上相邻的扇区在物理上有一定的间隔

### 错位命名

- 使相邻盘面的扇区编号错位

### 磁盘地址结构设计优化

- 使用【柱面号，盘面号，扇区号】
- 读取地址连续的磁盘块时，相比【盘面号，柱面号，扇区号】不会过多的移动磁头切换磁道

# 磁盘管理

## 磁盘初始化

1. ==低级格式化==（==物理格式化==），将磁盘的各个磁道==划分为扇区==。一个扇区通常可分为头、数据区域、尾三个部分组成。管理扇区所需要的各种数据结构一般存放在头、尾两个部分，包括扇区校验码
2. 磁盘分区，每个分区由若干个柱面组成（即分为熟悉的C盘、D盘、E盘）
3. ==逻辑格式化==，创建文件系统。包括创建文件系统的根目录、初始化存储空间所用的数据结构（如位示图、空闲分区表）

## 引导块

- 计算机开机时需要进行一系列初始化的工作，这些初始化工作是通过执行==初始化程序==（==自举程序==）完成的
- ROM中只存放很小的自举装入程序，完整的自举程序存放在磁盘的启动块（即引导块/启动分区）上，启动块位于磁盘的固定位置
- 拥有启动分区的磁盘称为启动磁盘或系统磁盘（C盘）

## 坏块管理

- > 坏了、无法正常使用的扇区就是坏块。属于硬件故障，操作系统无法修复。应将坏块标记出来，避免使用

- 简单的磁盘：逻辑格式化时标明哪些扇区是坏扇区。比如在FAT表上标明，这种方式==坏块对操作系统不透明==

- 复杂的磁盘：磁盘控制器（磁盘设备内部的一个硬件部件）会维护一个坏块链表。在磁盘出厂前进行低级格式化时就将坏块链进行初始化。会保留一些备用扇区，用于替换坏块。这种方案称为==扇区备用==。且这种处理方式==坏块对操作系统透明==